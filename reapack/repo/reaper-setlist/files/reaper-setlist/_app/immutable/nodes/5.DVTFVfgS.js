import{g as ce,n as A,C as se,r as re,B as ne,e as oe}from"../chunks/PsnSwRbB.js";import{f as S,a as u,s as L,c as Fe,t as ie}from"../chunks/Dktx9MQm.js";import{p as Oe,o as x,k as I,w as Re,m as t,v as p,s as v,f as H,a as Ee,c,r as n,t as P,q as j,n as J}from"../chunks/Dv93RvCJ.js";import{i as M}from"../chunks/5mgx-mTD.js";import{b as le}from"../chunks/l-MW7BRb.js";import{S as Ie}from"../chunks/CHhcvD1X.js";const je=async({fetch:B,params:m})=>{try{const o=m.id,f=ce(B),[g,T,_]=await Promise.all([f.sets.get(o),f.songs.list(),f.script.getOpenTabs()]);return{set:g,songs:T,tabs:_}}catch(o){return{set:void 0,songs:{},tabs:{activeIndex:-1,tabs:[]},error:o instanceof Error?o.message:"An unknown error occurred."}}},Qe=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"}));var Me=S('<p style="color: red;"> </p>'),Be=S('<li class="dirty-tab svelte-1p99pno"><span class="tab-name svelte-1p99pno"> </span> <span class="tab-index svelte-1p99pno"> </span></li>'),De=S('<div class="warning-container svelte-1p99pno"><div class="warning-message svelte-1p99pno"><h3 class="svelte-1p99pno">⚠️ Unsaved Changes Detected</h3> <p class="svelte-1p99pno"> </p> <div class="dirty-tabs-list svelte-1p99pno"><p class="svelte-1p99pno"><strong>Tabs with unsaved changes:</strong></p> <ul class="dirty-tabs svelte-1p99pno"></ul></div> <p class="svelte-1p99pno"><strong>What to do:</strong></p> <ul class="svelte-1p99pno"><li class="svelte-1p99pno">Save your changes in Reaper, then click "Check Again" below</li> <li class="svelte-1p99pno">Or disable "Replace existing tabs" to keep your current tabs</li></ul> <!></div></div>'),Ne=S('<div class="steps-container svelte-1p99pno"></div>'),Ue=S('<div class="options-container svelte-1p99pno"><label class="checkbox-label svelte-1p99pno"><input type="checkbox" class="svelte-1p99pno"/> Replace existing tabs (close all tabs before loading)</label> <label class="checkbox-label svelte-1p99pno"><input type="checkbox" class="svelte-1p99pno"/> Move playhead to start for each song</label></div> <div class="load-button-container svelte-1p99pno"><!></div> <!> <!>',1),qe=S("<p>Set not found.</p>"),ze=S("<meta:head><title>Load Set - Reaper Setlist</title></meta:head> <h1>Load Set</h1> <!>",1);function Ve(B,m){Oe(m,!0);let o=x(!1),f=x(!1),g=x(!0),T=x(!0),_=x(I(m.data.tabs.tabs)),k=I(m.data.set),pe=I(m.data.songs),de=J(()=>t(_).some(e=>e.dirty)),F=x(!1),K=J(()=>t(g)&&t(de));const Q=m.data.error,b=ce();let y=x(I([]));Re(()=>{k&&!t(o)&&!t(f)&&V(),t(g),t(T)});function V(){if(!k)return;const e=[];t(g)&&e.push({id:"close-all-tabs",title:"Close All Tabs",description:"Close all existing tabs in Reaper before loading the setlist",status:"pending",action:()=>fe()}),k.songs.forEach((a,s)=>{const r=pe[a];(s>0||!t(g))&&e.push({id:s===0?"open-new-tab-initial":`new-tab-${s}`,title:"Open New Tab",description:s===0?"Create a new tab in Reaper for the setlist":`Create a new tab in Reaper for ${r.name}`,status:"pending",action:()=>ve()}),e.push({id:`load-song-${a}`,title:`Load ${r.name}`,description:`Load the project file for ${r.name}`,status:"pending",action:()=>ue(r)}),t(T)&&e.push({id:`go-to-start-${s}`,title:"Move Playhead to Start",description:`Position the playhead at the beginning of ${r.name}`,status:"pending",action:()=>ge()})}),k.songs.length>0&&e.push({id:"switch-to-first-song",title:"Switch to First Song",description:"Navigate to the first song tab in the setlist",status:"pending",action:()=>be()}),p(y,e,!0)}async function ue(e){try{return await b.script.openProject(e.path),!0}catch(a){return A.error(`Failed to load song "${e.name}": ${a.message}`),!1}}async function ve(){try{return await b.reaper.newTab(),!0}catch(e){return A.error(`Failed to open new tab: ${e.message}`),!1}}async function fe(){try{return await b.reaper.closeAllTabs(),!0}catch(e){return A.error(`Failed to close all tabs: ${e.message}`),!1}}async function ge(){try{return await b.reaper.goToStart(),!0}catch(e){return A.error(`Failed to move playhead to start: ${e.message}`),!1}}async function be(){try{let e;const s=(await b.script.getOpenTabs()).activeIndex;t(g)?e=0:e=m.data.tabs.tabs.length;const r=e-s;if(r>0){const O=Array(r).fill(0).map(()=>se.nextTab());await b.reaper.executeCommands(O)}else if(r<0){const O=Array(-r).fill(0).map(()=>se.previousTab());await b.reaper.executeCommands(O)}return!0}catch(e){return A.error(`Failed to switch to first song: ${e.message}`),!1}}function D(e,a){const s=t(y).findIndex(r=>r.id===e);s!==-1&&(t(y)[s].status=a)}async function he(e){D(e.id,"running");try{let a=!1;return a=await e.action(),D(e.id,a?"completed":"error"),a}catch(a){return console.error(`Error executing step ${e.id}:`,a),D(e.id,"error"),!1}}async function me(){if(!t(F)){p(F,!0);try{const e=await b.script.getOpenTabs();p(_,e.tabs,!0)}catch(e){A.error(`Failed to refresh tabs: ${e.message}`)}finally{p(F,!1)}}}async function _e(){if(!(!k||t(o))&&(t(f)&&(p(f,!1),V()),t(y).length!==0)){p(_,(await b.script.getOpenTabs()).tabs,!0),p(o,!0),p(f,!0);try{for(const e of t(y))await he(e)||console.warn(`Step ${e.id} failed, but continuing...`),await new Promise(s=>setTimeout(s,200))}catch(e){console.error("Error during setlist loading:",e)}finally{p(o,!1)}}}var X=ze(),ye=v(H(X),4);{var we=e=>{var a=Me(),s=c(a,!0);n(a),P(()=>L(s,Q)),u(e,a)},xe=e=>{var a=Fe(),s=H(a);{var r=$=>{var E=Ue(),N=H(E),U=c(N),q=c(U);re(q),j(),n(U);var Z=v(U,2),z=c(Z);re(z),j(),n(Z),n(N);var W=v(N,2),Se=c(W);{let i=J(()=>t(o)||t(K));ne(Se,{onclick:_e,get disabled(){return t(i)},children:(h,w)=>{j();var d=ie();P(()=>L(d,t(o)?"Loading...":t(f)?"Load Again":"Load Set")),u(h,d)},$$slots:{default:!0}})}n(W);var ee=v(W,2);{var Te=i=>{var h=De(),w=c(h),d=v(c(w),2),Ce=c(d);n(d);var Y=v(d,2),te=v(c(Y),2);oe(te,21,()=>t(_).filter(l=>l.dirty),l=>l.index,(l,R)=>{var C=Be(),G=c(C),Le=c(G,!0);n(G);var ae=v(G,2),Pe=c(ae);n(ae),n(C),P(()=>{L(Le,t(R).name||"Untitled"),L(Pe,`(Tab ${t(R).index+1})`)}),u(l,C)}),n(te),n(Y);var Ae=v(Y,6);ne(Ae,{onclick:me,get disabled(){return t(F)},variant:"text",children:(l,R)=>{j();var C=ie();P(()=>L(C,t(F)?"Checking...":"Check Again")),u(l,C)},$$slots:{default:!0}}),n(w),n(h),P((l,R)=>L(Ce,`You have unsaved changes in ${l??""} tab${R??""}.
					Since "Replace existing tabs" is enabled, these changes will be lost when loading the set.`),[()=>t(_).filter(l=>l.dirty).length,()=>t(_).filter(l=>l.dirty).length===1?"":"s"]),u(i,h)};M(ee,i=>{t(K)&&i(Te)})}var ke=v(ee,2);{var $e=i=>{var h=Ne();oe(h,21,()=>t(y),w=>w.id,(w,d)=>{Ie(w,{get title(){return t(d).title},get description(){return t(d).description},get status(){return t(d).status}})}),n(h),u(i,h)};M(ke,i=>{t(y).length>0&&i($e)})}P(()=>{q.disabled=t(o),z.disabled=t(o)}),le(q,()=>t(g),i=>p(g,i)),le(z,()=>t(T),i=>p(T,i)),u($,E)},O=$=>{var E=qe();u($,E)};M(s,$=>{k?$(r):$(O,!1)},!0)}u(e,a)};M(ye,e=>{Q?e(we):e(xe,!1)})}u(B,X),Ee()}export{Ve as component,Qe as universal};
