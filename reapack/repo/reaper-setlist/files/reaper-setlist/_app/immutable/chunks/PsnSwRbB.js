var ne=Object.defineProperty;var xt=r=>{throw TypeError(r)};var ie=(r,t,e)=>t in r?ne(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var M=(r,t,e)=>ie(r,typeof t!="symbol"?t+"":t,e),oe=(r,t,e)=>t.has(r)||xt("Cannot "+e);var G=(r,t,e)=>(oe(r,t,"read from private field"),e?e.call(r):t.get(r)),ct=(r,t,e)=>t.has(r)?xt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e);import{d as nt,m as F,a0 as ce,g as et,N as $,Q as le,M as wt,a9 as ue,ad as bt,aK as Ut,aL as zt,aM as fe,h as k,b as de,aE as Bt,aN as Vt,R as he,S as pe,U as Tt,V as lt,W as Y,O as tt,af as me,aG as ge,J as Ht,L as ve,aO as ut,aA as we,aP as Se,aQ as Ce,aD as _e,K as rt,at as ye,am as Et,aR as Gt,I as Jt,aS as Re,E as xe,C as _t,l as be,as as Te,aT as Ee,aU as Pe,j as ke,aV as Ae,aW as Ie,aX as Ne,aY as Oe,aZ as Me,a_ as Le,a$ as je,b0 as Fe,b1 as De,o as st,k as Xt,v as H,p as Ke,f as Pt,a as Ue,c as kt,y as At,r as It,t as Nt,n as ze}from"./Dv93RvCJ.js";import{i as Be,j as Ve,d as qt,n as He,k as Ge,b as Je,a as q,c as Ot,f as Yt}from"./Dktx9MQm.js";import{B as Xe,r as qe,p as Ye,i as Mt,b as Lt}from"./5mgx-mTD.js";let ft=null;function zr(r,t){return t}function We(r,t,e){for(var s=[],a=t.length,n=0;n<a;n++)Se(t[n].e,s,!0);Ce(s,()=>{var i=s.length===0&&e!==null;if(i){var o=e,c=o.parentNode;_e(c),c.append(o),r.items.clear(),K(r,t[0].prev,t[a-1].next)}for(var p=0;p<a;p++){var m=t[p];i||(r.items.delete(m.k),K(r,m.prev,m.next)),rt(m.e,!i)}r.first===t[0]&&(r.first=t[0].prev)})}function Br(r,t,e,s,a,n=null){var i=r,o=new Map,c=null,p=(t&Gt)!==0,m=(t&zt)!==0,S=(t&Ut)!==0;if(p){var f=r;i=k?lt(ye(f)):f.appendChild(wt())}k&&de();var d=null,l=ce(()=>{var g=e();return Vt(g)?g:g==null?[]:Bt(g)}),y,u=!0;function h(){$e(x,y,i,t,s),d!==null&&(y.length===0?(d.fragment?(i.before(d.fragment),d.fragment=null):Ht(d.effect),D.first=d.effect):ve(d.effect,()=>{d=null}))}var D=nt(()=>{y=F(l);var g=y.length;let O=!1;if(k){var w=he(i)===pe;w!==(g===0)&&(i=Tt(),lt(i),Y(!1),O=!0)}for(var v=new Set,R=et,A=null,b=le(),N=0;N<g;N+=1){k&&tt.nodeType===me&&tt.data===ge&&(i=tt,O=!0,Y(!1));var z=y[N],B=s(z,N),E=u?null:o.get(B);E?(m&&Et(E.v,z),S?Et(E.i,N):E.i=N,b&&R.skipped_effects.delete(E.e)):(E=Ze(u?i:null,A,z,B,N,a,t,e),u&&(E.o=!0,A===null?c=E:A.next=E,A=E),o.set(B,E)),v.add(B)}if(g===0&&n&&!d)if(u)d={fragment:null,effect:$(()=>n(i))};else{var yt=document.createDocumentFragment(),Rt=wt();yt.append(Rt),d={fragment:yt,effect:$(()=>n(Rt))}}if(k&&g>0&&lt(Tt()),!u)if(b){for(const[se,ae]of o)v.has(se)||R.skipped_effects.add(ae.e);R.oncommit(h),R.ondiscard(()=>{})}else h();O&&Y(!0),F(l)}),x={effect:D,items:o,first:c};u=!1,k&&(i=tt)}function $e(r,t,e,s,a){var b,N,z,B;var n=(s&Re)!==0,i=t.length,o=r.items,c=r.first,p,m=null,S,f=[],d=[],l,y,u,h;if(n)for(h=0;h<i;h+=1)l=t[h],y=a(l,h),u=o.get(y),(b=u.a)==null||b.measure(),(S??(S=new Set)).add(u);for(h=0;h<i;h+=1){if(l=t[h],y=a(l,h),u=o.get(y),r.first??(r.first=u),!u.o){u.o=!0;var D=m?m.next:c;K(r,m,u),K(r,u,D),dt(u,D,e),m=u,f=[],d=[],c=m.next;continue}if((u.e.f&ut)!==0&&(Ht(u.e),n&&((N=u.a)==null||N.unfix(),(S??(S=new Set)).delete(u))),u!==c){if(p!==void 0&&p.has(u)){if(f.length<d.length){var x=d[0],g;m=x.prev;var O=f[0],w=f[f.length-1];for(g=0;g<f.length;g+=1)dt(f[g],x,e);for(g=0;g<d.length;g+=1)p.delete(d[g]);K(r,O.prev,w.next),K(r,m,O),K(r,w,x),c=x,m=w,h-=1,f=[],d=[]}else p.delete(u),dt(u,c,e),K(r,u.prev,u.next),K(r,u,m===null?r.first:m.next),K(r,m,u),m=u;continue}for(f=[],d=[];c!==null&&c.k!==y;)(c.e.f&ut)===0&&(p??(p=new Set)).add(c),d.push(c),c=c.next;if(c===null)continue;u=c}f.push(u),m=u,c=u.next}if(c!==null||p!==void 0){for(var v=p===void 0?[]:Bt(p);c!==null;)(c.e.f&ut)===0&&v.push(c),c=c.next;var R=v.length;if(R>0){var A=(s&Gt)!==0&&i===0?e:null;if(n){for(h=0;h<R;h+=1)(z=v[h].a)==null||z.measure();for(h=0;h<R;h+=1)(B=v[h].a)==null||B.fix()}We(r,v,A)}}n&&Jt(()=>{var E;if(S!==void 0)for(u of S)(E=u.a)==null||E.apply()})}function Ze(r,t,e,s,a,n,i,o){var c=ft,p=(i&zt)!==0,m=(i&fe)===0,S=p?m?ue(e,!1,!1):bt(e):e,f=(i&Ut)===0?a:bt(a),d={i:f,v:S,k:s,a:null,e:null,o:!1,prev:t,next:null};ft=d;try{if(r===null){var l=document.createDocumentFragment();l.append(r=wt())}return d.e=$(()=>n(r,S,f,o)),t!==null&&(t.next=d),d}finally{ft=c}}function dt(r,t,e){for(var s=r.next?r.next.e.nodes_start:e,a=t?t.e.nodes_start:e,n=r.e.nodes_start;n!==null&&n!==s;){var i=we(n);a.before(n),n=i}}function K(r,t,e){t===null?(r.first=e,r.effect.first=e&&e.e):(t.e.next&&(t.e.next.prev=null),t.next=e,t.e.next=e&&e.e),e===null?r.effect.last=t&&t.e:(e.e.prev&&(e.e.prev.next=null),e.prev=t,e.e.prev=t&&t.e)}function jt(r,t,...e){var s=new Xe(r);nt(()=>{const a=t()??null;s.ensure(a,a&&(n=>a(n,...e)))},xe)}function Qe(r,t){var e=void 0,s;nt(()=>{e!==(e=t())&&(s&&(rt(s),s=null),e&&(s=$(()=>{_t(()=>e(r))})))})}function Wt(r){var t,e,s="";if(typeof r=="string"||typeof r=="number")s+=r;else if(typeof r=="object")if(Array.isArray(r)){var a=r.length;for(t=0;t<a;t++)r[t]&&(e=Wt(r[t]))&&(s&&(s+=" "),s+=e)}else for(e in r)r[e]&&(s&&(s+=" "),s+=e);return s}function tr(){for(var r,t,e=0,s="",a=arguments.length;e<a;e++)(r=arguments[e])&&(t=Wt(r))&&(s&&(s+=" "),s+=t);return s}function er(r){return typeof r=="object"?tr(r):r??""}const Ft=[...` 	
\r\fÂ \v\uFEFF`];function rr(r,t,e){var s=r==null?"":""+r;if(t&&(s=s?s+" "+t:t),e){for(var a in e)if(e[a])s=s?s+" "+a:a;else if(s.length)for(var n=a.length,i=0;(i=s.indexOf(a,i))>=0;){var o=i+n;(i===0||Ft.includes(s[i-1]))&&(o===s.length||Ft.includes(s[o]))?s=(i===0?"":s.substring(0,i))+s.substring(o+1):i=o}}return s===""?null:s}function Dt(r,t=!1){var e=t?" !important;":";",s="";for(var a in r){var n=r[a];n!=null&&n!==""&&(s+=" "+a+": "+n+e)}return s}function ht(r){return r[0]!=="-"||r[1]!=="-"?r.toLowerCase():r}function sr(r,t){if(t){var e="",s,a;if(Array.isArray(t)?(s=t[0],a=t[1]):s=t,r){r=String(r).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var n=!1,i=0,o=!1,c=[];s&&c.push(...Object.keys(s).map(ht)),a&&c.push(...Object.keys(a).map(ht));var p=0,m=-1;const y=r.length;for(var S=0;S<y;S++){var f=r[S];if(o?f==="/"&&r[S-1]==="*"&&(o=!1):n?n===f&&(n=!1):f==="/"&&r[S+1]==="*"?o=!0:f==='"'||f==="'"?n=f:f==="("?i++:f===")"&&i--,!o&&n===!1&&i===0){if(f===":"&&m===-1)m=S;else if(f===";"||S===y-1){if(m!==-1){var d=ht(r.substring(p,m).trim());if(!c.includes(d)){f!==";"&&S++;var l=r.substring(p,S).trim();e+=" "+l+";"}}p=S+1,m=-1}}}}return s&&(e+=Dt(s)),a&&(e+=Dt(a,!0)),e=e.trim(),e===""?null:e}return r==null?null:String(r)}function St(r,t,e,s,a,n){var i=r.__className;if(k||i!==e||i===void 0){var o=rr(e,s,n);(!k||o!==r.getAttribute("class"))&&(o==null?r.removeAttribute("class"):t?r.className=o:r.setAttribute("class",o)),r.__className=e}else if(n&&a!==n)for(var c in n){var p=!!n[c];(a==null||p!==!!a[c])&&r.classList.toggle(c,p)}return n}function pt(r,t={},e,s){for(var a in e){var n=e[a];t[a]!==n&&(e[a]==null?r.style.removeProperty(a):r.style.setProperty(a,n,s))}}function Ct(r,t,e,s){var a=r.__style;if(k||a!==t){var n=sr(t,s);(!k||n!==r.getAttribute("style"))&&(n==null?r.removeAttribute("style"):r.style.cssText=n),r.__style=t}else s&&(Array.isArray(s)?(pt(r,e==null?void 0:e[0],s[0]),pt(r,e==null?void 0:e[1],s[1],"important")):pt(r,e,s));return s}function at(r,t,e=!1){if(r.multiple){if(t==null)return;if(!Vt(t))return Ee();for(var s of r.options)s.selected=t.includes(W(s));return}for(s of r.options){var a=W(s);if(Pe(a,t)){s.selected=!0;return}}(!e||t!==void 0)&&(r.selectedIndex=-1)}function $t(r){var t=new MutationObserver(()=>{at(r,r.__value)});t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Te(()=>{t.disconnect()})}function Vr(r,t,e=t){var s=new WeakSet,a=!0;be(r,"change",n=>{var i=n?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(i),W);else{var c=r.querySelector(i)??r.querySelector("option:not([disabled])");o=c&&W(c)}e(o),et!==null&&s.add(et)}),_t(()=>{var n=t();if(r===document.activeElement){var i=ke??et;if(s.has(i))return}if(at(r,n,a),a&&n===void 0){var o=r.querySelector(":checked");o!==null&&(n=W(o),e(n))}r.__value=n,a=!1}),$t(r)}function W(r){return"__value"in r?r.__value:r.value}const J=Symbol("class"),X=Symbol("style"),Zt=Symbol("is custom element"),Qt=Symbol("is html");function ar(r){if(k){var t=!1,e=()=>{if(!t){if(t=!0,r.hasAttribute("value")){var s=r.value;U(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var a=r.checked;U(r,"checked",null),r.checked=a}}};r.__on_r=e,Jt(e),je()}}function Hr(r,t){var e=it(r);e.value===(e.value=t??void 0)||r.value===t&&(t!==0||r.nodeName!=="PROGRESS")||(r.value=t??"")}function Gr(r,t){var e=it(r);e.checked!==(e.checked=t??void 0)&&(r.checked=t)}function nr(r,t){t?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function U(r,t,e,s){var a=it(r);k&&(a[t]=r.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&r.nodeName==="LINK")||a[t]!==(a[t]=e)&&(t==="loading"&&(r[Fe]=e),e==null?r.removeAttribute(t):typeof e!="string"&&te(r).includes(t)?r[t]=e:r.setAttribute(t,e))}function ir(r,t,e,s,a=!1,n=!1){if(k&&a&&r.tagName==="INPUT"){var i=r,o=i.type==="checkbox"?"defaultChecked":"defaultValue";o in e||ar(i)}var c=it(r),p=c[Zt],m=!c[Qt];let S=k&&p;S&&Y(!1);var f=t||{},d=r.tagName==="OPTION";for(var l in t)l in e||(e[l]=null);e.class?e.class=er(e.class):e[J]&&(e.class=null),e[X]&&(e.style??(e.style=null));var y=te(r);for(const w in e){let v=e[w];if(d&&w==="value"&&v==null){r.value=r.__value="",f[w]=v;continue}if(w==="class"){var u=r.namespaceURI==="http://www.w3.org/1999/xhtml";St(r,u,v,s,t==null?void 0:t[J],e[J]),f[w]=v,f[J]=e[J];continue}if(w==="style"){Ct(r,v,t==null?void 0:t[X],e[X]),f[w]=v,f[X]=e[X];continue}var h=f[w];if(!(v===h&&!(v===void 0&&r.hasAttribute(w)))){f[w]=v;var D=w[0]+w[1];if(D!=="$$")if(D==="on"){const R={},A="$$"+w;let b=w.slice(2);var x=Ge(b);if(Be(b)&&(b=b.slice(0,-7),R.capture=!0),!x&&h){if(v!=null)continue;r.removeEventListener(b,f[A],R),f[A]=null}if(v!=null)if(x)r[`__${b}`]=v,qt([b]);else{let N=function(z){f[w].call(this,z)};f[A]=Ve(b,r,N,R)}else x&&(r[`__${b}`]=void 0)}else if(w==="style")U(r,w,v);else if(w==="autofocus")Me(r,!!v);else if(!p&&(w==="__value"||w==="value"&&v!=null))r.value=r.__value=v;else if(w==="selected"&&d)nr(r,v);else{var g=w;m||(g=He(g));var O=g==="defaultValue"||g==="defaultChecked";if(v==null&&!p&&!O)if(c[w]=null,g==="value"||g==="checked"){let R=r;const A=t===void 0;if(g==="value"){let b=R.defaultValue;R.removeAttribute(g),R.defaultValue=b,R.value=R.__value=A?b:null}else{let b=R.defaultChecked;R.removeAttribute(g),R.defaultChecked=b,R.checked=A?b:!1}}else r.removeAttribute(w);else O||y.includes(g)&&(p||typeof v!="string")?(r[g]=v,g in c&&(c[g]=Le)):typeof v!="function"&&U(r,g,v)}}}return S&&Y(!0),f}function or(r,t,e=[],s=[],a=[],n,i=!1,o=!1){Ne(a,e,s,c=>{var p=void 0,m={},S=r.nodeName==="SELECT",f=!1;if(nt(()=>{var l=t(...c.map(F)),y=ir(r,p,l,n,i,o);f&&S&&"value"in l&&at(r,l.value);for(let h of Object.getOwnPropertySymbols(m))l[h]||rt(m[h]);for(let h of Object.getOwnPropertySymbols(l)){var u=l[h];h.description===Oe&&(!p||u!==p[h])&&(m[h]&&rt(m[h]),m[h]=$(()=>Qe(r,()=>u))),y[h]=u}p=y}),S){var d=r;_t(()=>{at(d,p.value,!0),$t(d)})}f=!0})}function it(r){return r.__attributes??(r.__attributes={[Zt]:r.nodeName.includes("-"),[Qt]:r.namespaceURI===Ae})}var Kt=new Map;function te(r){var t=r.getAttribute("is")||r.nodeName,e=Kt.get(t);if(e)return e;Kt.set(t,e=[]);for(var s,a=r,n=Element.prototype;n!==a;){s=De(a);for(var i in s)s[i].set&&e.push(i);a=Ie(a)}return e}function Jr(r){const t=Math.floor(r/60),e=Math.floor(r%60);return`${t}:${e.toString().padStart(2,"0")}`}function ee(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}var Z;class cr{constructor(){ct(this,Z,st(Xt([])))}get notifications(){return F(G(this,Z))}set notifications(t){H(G(this,Z),t,!0)}get items(){return this.notifications}add(t,e="primary",s){const a=ee(),n={id:a,message:t,type:e,duration:s,timestamp:new Date};return this.notifications=[...this.notifications,n],s!==void 0&&setTimeout(()=>{this.remove(a)},s),a}remove(t){this.notifications=this.notifications.filter(e=>e.id!==t)}clear(){this.notifications=[]}success(t,e=5e3){return this.add(t,"success",e)}error(t,e){return this.add(t,"delete",e)}warning(t,e=7e3){return this.add(t,"edit",e)}info(t,e=5e3){return this.add(t,"primary",e)}}Z=new WeakMap;const Xr=new cr,lr="Operation",V={ProjectRoot:"ProjectRoot",ScriptActionId:"ScriptActionId",ExportPath:"ExportPath"},_={ReaperSetlist:"ReaperSetlist",Songs:"ReaperSetlist.Songs",Sets:"ReaperSetlist.Sets"};class ot{}class ur extends ot{parseResponse(t){if(!t)throw new Error("Empty transport response");const e=t.split("	");if(e.length!==6)throw new Error(`Unexpected transport format: ${t}`);return{playState:parseInt(e[1],10),positionSeconds:parseFloat(e[2]),repeatOn:e[3]==="1",positionString:e[4],positionStringBeats:e[5]}}getResponseMarker(){return"TRANSPORT"}async getCommandString(){return Promise.resolve("TRANSPORT")}}class fr extends ot{parseResponse(t){const e=[];for(const s of t){if(s.startsWith("MARKER_LIST"))continue;if(s.startsWith("MARKER_LIST_END"))break;const a=s.split("	");if(a.length<4)throw new Error(`Invalid marker line: ${s}`);const n={id:parseInt(a[2],10),name:a[1],position:parseFloat(a[3])};e.push(n)}return e}getResponseMarker(){return"MARKER_LIST"}async getCommandString(){return Promise.resolve("MARKER")}}class I extends ot{parseResponse(t){}getResponseMarker(){}}class dr extends I{getCommandString(){return Promise.resolve("40042")}}class hr extends I{getCommandString(){return Promise.resolve("40859")}}class pr extends I{getCommandString(){return Promise.resolve("40860")}}class mr extends I{getCommandString(){return Promise.resolve("40886")}}class gr extends I{getCommandString(){return Promise.resolve("40861")}}class vr extends I{getCommandString(){return Promise.resolve("40862")}}class wr extends I{getCommandString(){return Promise.resolve("1007")}}class Sr extends I{getCommandString(){return Promise.resolve("1008")}}class Cr extends I{getCommandString(){return Promise.resolve("1016")}}class _r extends I{getCommandString(){return Promise.resolve("1013")}}class L extends I{async getCommandString(){if(await vt.ensureInitialized(),!vt.scriptActionId)throw new Error("Script action ID is not set. Please configure it in the settings.");return vt.scriptActionId}}class yr extends I{constructor(t){super(),this.markerId=t}async getCommandString(){return Promise.resolve(`SET/POS_STR/m${this.markerId}`)}}class T extends I{constructor(t,e,s,a=!1){super(),this.section=t,this.key=e,this.value=s,this.persist=a}async getCommandString(){const t=this.persist?"SET/EXTSTATEPERSIST":"SET/EXTSTATE",e=encodeURIComponent(this.value);return Promise.resolve(`${t}/${this.section}/${this.key}/${e}`)}}class j extends T{constructor(t){super(_.ReaperSetlist,lr,t,!1)}}class P extends ot{constructor(t,e,s=!0){super(),this.section=t,this.key=e,this.temp=s}getCommandString(){const t=this.temp?"GET/EXTSTATE":"GET/EXTSTATE_PERSIST";return Promise.resolve(`${t}/${this.section}/${this.key}`)}parseResponse(t){if(!t||t.trim()==="")return;const e=t.trim(),s=e.split("	");if(s.length===4&&s[0]==="EXTSTATE"&&s[1]===this.section&&s[2]===this.key)return s[3];if(s.length===3&&s[0]==="EXTSTATE"&&s[1]===this.section&&s[2]===this.key)return;throw new Error(`Unexpected response format: ${e}`)}getResponseMarker(){return"EXTSTATE"}}const C={transport:()=>new ur,markers:()=>new fr,goToStart:()=>new dr,goToMarker:r=>new yr(r),newTab:()=>new hr,closeTab:()=>new pr,closeAllTabs:()=>new mr,nextTab:()=>new gr,previousTab:()=>new vr,play:()=>new wr,pause:()=>new Sr,stop:()=>new Cr,record:()=>new _r},Rr=600;class xr{constructor(t,e=globalThis.fetch){M(this,"urlRoot");M(this,"fetch");this.urlRoot=t,this.fetch=e}async executeCommand(t){const[e]=await this.executeCommands([t]);return e}async executeCommands(t){const e=await Promise.all(t.map(n=>n.getCommandString())),s=await this.sendRawCommands(e);return this.parseMultiCommandResponse(t,s)}parseMultiCommandResponse(t,e){const s=[];let a=0;for(const n of t){if(!n.getResponseMarker()){s.push(void 0);continue}const i=e[a];if(i.length===0)throw new Error(`Empty response for command: ${n.getCommandString()}`);const o=i.split("	")[0];if(o!==n.getResponseMarker())throw new Error(`Unexpected response type for command ${n.getCommandString()}: expected ${n.getResponseMarker()}, got ${o}`);if(n.getResponseMarker()==="MARKER_LIST"){const c=n.parseResponse(e.slice(a)),p=c;s.push(c),a+=p.length+1}else{const c=n.parseResponse(i);s.push(c)}a++}return s}async sendCommand(t){return this.sendRawCommand(t)}async sendCommands(t){return this.sendRawCommands(t)}async getTransport(){return this.executeCommand(C.transport())}async goToStart(){const[t,e]=await this.executeCommands([C.goToStart(),C.transport()]);return e}async play(){const[,t]=await this.executeCommands([C.play(),C.transport()]);return t}async pause(){const[,t]=await this.executeCommands([C.pause(),C.transport()]);return t}async stop(){const[,t]=await this.executeCommands([C.stop(),C.transport()]);return t}async record(){const[,t]=await this.executeCommands([C.record(),C.transport()]);return t}async closeTab(){await this.executeCommand(C.closeTab())}async newTab(){await this.executeCommand(C.newTab())}async closeAllTabs(){await this.executeCommand(C.closeAllTabs())}async nextTab(){const[,t,e]=await this.executeCommands([C.nextTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async previousTab(){const[,t,e]=await this.executeCommands([C.previousTab(),C.transport(),C.markers()]);return{markers:e,transport:t}}async getMarkers(){return this.executeCommand(C.markers())}async goToMarker(t){const[e,s]=await this.executeCommands([C.goToMarker(t),C.transport()]);return s}async playAndGetFullState(){const[t,e,s]=await this.executeCommands([C.play(),C.transport(),C.markers()]);return{playResult:t,transport:e,markers:s}}async sendRawCommand(t){const e=await this.fetch(`${this.urlRoot}/${t}`,{method:"GET"});if(!e.ok)throw new Error(`Failed to send command ${t}: ${e.statusText}`);return(await e.text()).split(`
`).filter(n=>n.trim()!=="")}async sendRawCommands(t){if(t.length===0)return[];const e=[],s=this.batchCommandsByUrlLength(t);for(const a of s){const n=`${this.urlRoot}/${a.join(";")}`,i=await this.fetch(n,{method:"GET"});if(!i.ok)throw new Error(`Failed to send commands ${a.join(",")}: ${i.statusText}`);const c=(await i.text()).split(`
`).slice(0,-1);e.push(...c)}return e}batchCommandsByUrlLength(t){const e=[];let s=[],a=this.urlRoot.length;for(const n of t){const o=(s.length>0?";":"").length+n.length;a+o>Rr&&s.length>0?(e.push([...s]),s=[n],a=this.urlRoot.length+n.length):(s.push(n),a+=o)}return s.length>0&&e.push(s),e}}class br{}const Tr=500,mt="__index__";class re extends br{constructor(t,e,s){super(),this.apiClient=t,this.scriptClient=e,this.sectionKey=s}async fetchIndex(){const t=new P(this.sectionKey,mt),e=await this.apiClient.executeCommand(t);return e?JSON.parse(e):[]}async saveData(t,e){JSON.stringify(e).length<=Tr?await this.apiClient.executeCommand(new T(this.sectionKey,t,JSON.stringify(e),!0)):await this.scriptClient.writeChunkedData(this.sectionKey,t,e)}async saveIndex(t){await this.saveData(mt,t)}async fetchById(t){const e=new P(this.sectionKey,t),s=await this.apiClient.executeCommand(e);return s?JSON.parse(s):void 0}async saveById(t,e){await this.saveData(t,e)}async deleteById(t){await this.scriptClient.deleteState(this.sectionKey,t)}async get(t){return this.fetchById(t)}async update(t,e){await this.saveById(t,e)}async add(t){const e=ee(),s={...t,id:e};await this.saveById(e,s);const a=await this.fetchIndex();return a.push(e),await this.saveIndex(a),s}async delete(t){await this.deleteById(t);const s=(await this.fetchIndex()).filter(a=>a!==t);await this.saveIndex(s)}async list(){const t=new P(this.sectionKey,mt),e=await this.apiClient.executeCommand(t);if(!e)return{};const s=JSON.parse(e),a={},n=s.map(o=>new P(this.sectionKey,o)),i=await this.apiClient.executeCommands(n);for(const o of i)if(o){const c=JSON.parse(o);a[c.id]=c}return a}}class Er{constructor(t){this.apiClient=t}getChunkCommands(t,e){const s=[],a=JSON.stringify(e),n=500;for(let o=0;o<a.length;o+=n)s.push(a.slice(o,o+n));const i=[];i.push(new T(_.ReaperSetlist,`${t}_length`,s.length.toString()));for(let o=0;o<s.length;o++)i.push(new T(_.ReaperSetlist,`${t}_${o}`,s[o]));return i}async listProjects(){const t=[new j("listProjects"),new L,new P(_.ReaperSetlist,"projects")],[e,s,a]=await this.apiClient.executeCommands(t);if(a===void 0)throw new Error("Failed to retrieve projects. Please check the script configuration.");return JSON.parse(a)}async testProjectsFolder(t){const e=[new T(_.ReaperSetlist,"folderPath",t),new j("testProjectsFolder"),new L,new P(_.ReaperSetlist,"valid"),new P(_.ReaperSetlist,"message")],[s,a,n,i,o]=await this.apiClient.executeCommands(e);if(i===void 0)throw new Error("Failed to retrieve valid. Please check the script configuration.");const c=i==="true";if(o===void 0)throw new Error("Failed to retrieve message. Please check the script configuration.");return{valid:c,message:o}}async openProject(t){const e=[new T(_.ReaperSetlist,"projectPath",t),new j("openProject"),new L];await this.apiClient.executeCommands(e)}async testActionId(t){const e=[new T(_.ReaperSetlist,"testNonce",t),new j("testActionId"),new L,new P(_.ReaperSetlist,"testOutput")],[s,a,n,i]=await this.apiClient.executeCommands(e);if(i===void 0)throw new Error("Failed to retrieve testOutput. Please check the script configuration.");return i}async getProjectLength(){const t=[new j("getProjectLength"),new L,new P(_.ReaperSetlist,"projectLength")],[e,s,a]=await this.apiClient.executeCommands(t);if(a===void 0)throw new Error("Failed to retrieve projectLength. Please check the script configuration.");return parseFloat(a)}async getOpenTabs(){const t=[new j("getOpenTabs"),new L,new P(_.ReaperSetlist,"tabs"),new P(_.ReaperSetlist,"activeIndex")],[e,s,a,n]=await this.apiClient.executeCommands(t);if(a===void 0)throw new Error("Failed to retrieve tabs. Please check the script configuration.");const i=JSON.parse(a);if(n===void 0)throw new Error("Failed to retrieve activeIndex. Please check the script configuration.");const o=parseFloat(n);return{tabs:i,activeIndex:o}}async writeChunkedData(t,e,s){const a=[new T(_.ReaperSetlist,"section",t),new T(_.ReaperSetlist,"key",e),...this.getChunkCommands("chunks",s),new j("writeChunkedData"),new L];await this.apiClient.executeCommands(a)}async deleteState(t,e){const s=[new T(_.ReaperSetlist,"section",t),new T(_.ReaperSetlist,"key",e),new j("deleteState"),new L];await this.apiClient.executeCommands(s)}async getTrackNames(){const t=[new j("getTrackNames"),new L,new P(_.ReaperSetlist,"trackNames")],[e,s,a]=await this.apiClient.executeCommands(t);if(a===void 0)throw new Error("Failed to retrieve trackNames. Please check the script configuration.");return JSON.parse(a)}async browseFolder(t){const e=[new T(_.ReaperSetlist,"initialPath",t),new j("browseFolder"),new L,new P(_.ReaperSetlist,"path")],[s,a,n,i]=await this.apiClient.executeCommands(e);if(i===void 0)throw new Error("Failed to retrieve path. Please check the script configuration.");return i}async exportRecordings(t,e){const s=[new T(_.ReaperSetlist,"trackNames",JSON.stringify(t)),new T(_.ReaperSetlist,"exportPath",e),new j("exportRecordings"),new L];await this.apiClient.executeCommands(s)}}class Pr{constructor(t){this.apiClient=t}async getStateValue(t){const e=new P(_.ReaperSetlist,t);return await this.apiClient.executeCommand(e)}async setStateValue(t,e){const s=new T(_.ReaperSetlist,t,e,!0);await this.apiClient.executeCommand(s)}async getProjectRoot(){return await this.getStateValue(V.ProjectRoot)}async getScriptActionId(){return await this.getStateValue(V.ScriptActionId)}async setProjectRoot(t){await this.setStateValue(V.ProjectRoot,t)}async setScriptActionId(t){await this.setStateValue(V.ScriptActionId,t)}async getExportPath(){return await this.getStateValue(V.ExportPath)}async setExportPath(t){await this.setStateValue(V.ExportPath,t)}}class kr extends re{async deleteSongFromSets(t){const e=await this.list(),s=[];for(const a of Object.values(e))a.songs.includes(t)&&(a.songs=a.songs.filter(n=>n!==t),s.push(this.update(a.id,a)));await Promise.all(s)}}const Ar="/_";class Ir{constructor(t=globalThis.fetch,e=Ar){M(this,"reaper");M(this,"script");M(this,"scriptSettings");M(this,"songs");M(this,"sets");this.urlRoot=e;const s=new xr(this.urlRoot,t);this.reaper=s,this.script=new Er(s),this.scriptSettings=new Pr(s),this.songs=new re(s,this.script,_.Songs),this.sets=new kr(s,this.script,_.Sets)}}function gt(r){return new Ir(r)}var Q;class Nr{constructor(){ct(this,Q,st(Xt({scriptActionId:void 0,folderPath:void 0,exportPath:void 0,setupComplete:!1})));M(this,"initialized",!1);M(this,"initializing",!1);M(this,"initPromise",null)}get configuration(){return F(G(this,Q))}set configuration(t){H(G(this,Q),t,!0)}get data(){return this.configuration}get isSetupComplete(){return this.configuration.setupComplete}get scriptActionId(){return this.configuration.scriptActionId}get folderPath(){return this.configuration.folderPath}get exportPath(){return this.configuration.exportPath}async initialize(t){if(!this.initialized){if(this.initializing&&this.initPromise)return this.initPromise;this.initializing=!0,this.initPromise=this._doInitialize(t);try{await this.initPromise}finally{this.initializing=!1,this.initPromise=null}}}async _doInitialize(t){try{const e=gt(t),[s,a,n]=await Promise.all([e.scriptSettings.getScriptActionId(),e.scriptSettings.getProjectRoot(),e.scriptSettings.getExportPath()]);this.configuration.scriptActionId=s,this.configuration.folderPath=a,this.configuration.exportPath=n,this.configuration.setupComplete=!!(a&&s),this.initialized=!0}catch(e){console.error("Error initializing configuration:",e),this.configuration.setupComplete=!1}}ensureInitialized(t){return this.initialized?Promise.resolve():this.initialize(t)}async updateFolderPath(t,e){try{await gt(e).scriptSettings.setProjectRoot(t),this.configuration.folderPath=t;const a=!!(t&&this.configuration.scriptActionId);this.configuration.setupComplete!==a&&(this.configuration.setupComplete=a)}catch(s){throw console.error("Error updating folder path:",s),s}}async updateExportPath(t,e){try{await gt(e).scriptSettings.setExportPath(t),this.configuration.exportPath=t}catch(s){throw console.error("Error updating export path:",s),s}}updateSetupComplete(){this.configuration.setupComplete=!!(this.configuration.folderPath&&this.configuration.scriptActionId)}reset(){this.configuration.scriptActionId=void 0,this.configuration.folderPath=void 0,this.configuration.exportPath=void 0,this.configuration.setupComplete=!1,this.initialized=!1,this.initializing=!1,this.initPromise=null}}Q=new WeakMap;const vt=new Nr;var Or=Je('<svg><path fill="none" stroke="currentColor" stroke-dasharray="16" stroke-dashoffset="16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="16;0"></animate><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></path></svg>');function Mr(r,t){const e=qe(t,["$$slots","$$events","$$legacy"]);var s=Or();or(s,()=>({class:"icon",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",...e})),q(r,s)}var Lr=Yt("<a><!></a>"),jr=Yt("<button><!></button>");function qr(r,t){Ke(t,!0);let e=Ye(t,"variant",3,"text"),s=st(!1),a=st(void 0);function n(d,l){if(l==="submit")return"var(--green)";switch(d){default:case"primary":return"var(--primary)";case"delete":return"var(--red)";case"edit":return"var(--yellow)";case"success":return"var(--green)"}}function i(){return e()==="text"}async function o(d){var l;d.stopPropagation(),H(s,!0),await((l=t.onclick)==null?void 0:l.call(t)),H(s,!1)}const c=ze(()=>n(t.color,t.elementType));var p=Ot(),m=Pt(p);{var S=d=>{var l=Lr();let y;var u=kt(l);jt(u,()=>t.children??At),It(l),Lt(l,h=>H(a,h),()=>F(a)),Nt(h=>{y=St(l,1,"button svelte-179z4bh",null,y,h),U(l,"title",t.title),Ct(l,`--button-color: ${F(c)};`),U(l,"href",t.href)},[()=>({"text-button":i()})]),q(d,l)},f=d=>{var l=jr();let y;l.__click=o;var u=kt(l);{var h=x=>{Mr(x,{})},D=x=>{var g=Ot(),O=Pt(g);jt(O,()=>t.children??At),q(x,g)};Mt(u,x=>{F(s)?x(h):x(D,!1)})}It(l),Lt(l,x=>H(a,x),()=>F(a)),Nt(x=>{y=St(l,1,"button svelte-179z4bh",null,y,x),U(l,"type",t.elementType==="submit"?"submit":"button"),Ct(l,`--button-color: ${F(c)};`),U(l,"title",t.title),U(l,"aria-label",t.title),l.disabled=F(s)||t.disabled},[()=>({"text-button":i()})]),q(d,l)};Mt(m,d=>{t.elementType==="a"?d(S):d(f,!1)})}q(r,p),Ue()}qt(["click"]);export{qr as B,C,Mr as L,or as a,Vr as b,St as c,ft as d,Br as e,Jr as f,gt as g,Hr as h,zr as i,Ct as j,vt as k,U as l,ee as m,Xr as n,er as o,Gr as p,ar as r,jt as s};
